---
title: "Dplyr graded lab"
author: "Louise Cazalet Dance"
format: html
editor: visual
---
### Link to the github repository

https://github.com/cazaletlouise/eval-grades


```{r}
# Necessary packages 
library(readr)
library(dplyr)
library(tidyr)
library(vroom)
library(here)
library (knitr)
library(ggplot2)
library(lubridate)

here::i_am("eval-grades.Rproj")
```


## Introduction

### Study organization 

#### Question 1

```{r}
courses <- vroom(
  here("data", "courses.csv"))
```
##### Question 2

```{r}
courses |>
  rename(
  `course name` = course,
  identifier = course_id,
  `number of grades` = nb_grades
) |>
  arrange(`course name`) |>
  kable()
```

### Students

#### Question 3

```{r}
students <- vroom(
  here("data", "students.csv"))

students <- students |>
  mutate(
    birth_date = as.Date(birth_date),  
    sex = factor(sex),                
    group = factor(group),             
    id = as.integer(id)               
  )

birth_date_class <- class(students$birth_date)
sex_class <- class(students$sex)


```
The birth_date column of the students data frame is of class `{r} birth_date_class`.

The sex column of the students data frame is of class `{r} sex_class`.

### Grades

#### Question 4

```{r}
grades <- vroom(
  here("data", "grades.csv"),
  delim = "|",   
  na = "_"      
)

```

## Student population

### Question 5

```{r}

students_count <- students |>
  group_by(group) |>
  summarise(n_students = n())

ggplot(students_count, aes(x = group, y = n_students)) +
  geom_col(fill = "orange") +
  labs(
    title = "Number of Students per Group",
    x = "Group",
    y = "Number of Students"
  )
```

### Question 6

```{r}
students |>
  ggplot(aes(x = group, fill = sex)) +
  geom_bar(position = "fill") +  
  scale_y_continuous(labels = scales::percent_format()) +
  labs(
    title = "Gender Balance per Group",
    x = "Group",
    y = "Proportion of Students",
    fill = "Sex"
  )
```

### Question 7

```{r}

students <- students |>
  mutate(
    age = floor(time_length(today() - birth_date, unit = "year"))
  )


students |>
  ggplot(aes(x = age)) +
  geom_histogram(binwidth = 1, fill = "pink") +
  labs(
    title = "Distribution of Student Ages",
    x = "Age (years)",
    y = "Number of Students"
  )

```

### Question 8

```{r}
median_age_group <- students |>
  group_by(group) |>
  summarise(median_age = as.integer(median(age)))

median_age_group |>
  kable(
    caption = "Median age of students per group"
  )
```

### Question 9

```{r}
oldest_students <- students |>
  group_by(group) |>
  slice_max(order_by = age) |>
  select(id, sex, age) |>
  arrange(desc(age))


oldest_students |>
  kable(
    caption = "Oldest student in each group"
  )
```

## Simple grade analysis

### Question 10 

```{r}
n_grades <- sum(!is.na(grades$grade))
```

The data set contains `r n_grades` grades.

### Question 11

```{r}

avg_sanskrit <- grades |>
  filter(course_id == courses |>
           filter(course == "Sanskrit Language and Literature") |>
           pull(course_id)) |>
  left_join(students, by = "id") |>
  group_by(group) |>
  summarise(avg_grade = mean(grade, na.rm = TRUE))


avg_sanskrit |>
  ggplot(aes(x = factor(group), y = avg_grade)) +
  geom_col(fill = "lightgreen") +
  labs(
    title = "Average Grade in Sanskrit Language and Literature by Group",
    x = "Group",
    y = "Average Grade"
  ) 

```

### Question 12

```{r}
grades_semester<- grades |>
  left_join(courses |> select(course_id, semester), by = "course_id") |>
  filter(!is.na(grade))

grades_semester|>
  ggplot(aes(x = grade, fill = factor(semester))) +
  geom_density(alpha=0.5) +
  labs(
    title = "Distribution of grades by semester",
    x = "Grade",
    y = "Density",
    fill = "Semester"
  ) 

```



## Attendance analysis 

### Question 13

```{r}

grades_per_student <- grades |>
  filter(!is.na(grade)) |>
  group_by(id) |>
  summarise(
    n_grades = n(),
    .groups = "drop"
  ) |>
  left_join(students |> select(id, group, sex), by = "id")


grades_per_student |> 
  slice_head(n = 5) |>  
  kable(
    caption = "Number of grades per student",
    align = "c"
  )


grades_per_student_summary <- tibble(
  Minimum = min(grades_per_student$n_grades),
  Maximum = max(grades_per_student$n_grades),
  Average = round(mean(grades_per_student$n_grades), 2),
  Median = median(grades_per_student$n_grades)
)


```
| Statistic | Value |
|-----------|-------|
| Minimum   | `r min_grades` |
| Maximum   | `r max_grades` |
| Average   | `r mean_grades` |
| Median    | `r median_grades` |


### Question 14


```{r}
grades_per_student |>
  ggplot(aes(x = n_grades, fill = sex)) +
  geom_density(alpha = 0.4) +       
  labs(
    title = "Distribution of number of grades by sex",
    x = "Number of grades",
    y = "Density",
    fill = "Sex"
  ) 
```




NE PAS OUBLIER D'ENLEVER LES WARNING A LA FIN
